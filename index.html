<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A3</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font from Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* General body styling for a clean look */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            color: #333;
        }

        /* Custom message box for user feedback, avoiding native alerts */
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            text-align: center;
        }

        /* Styling for the modal popup */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            padding: 2rem;
            border-radius: 1rem;
            max-width: 90%;
            width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            position: relative;
        }
        .close-modal-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            color: #ccc;
            cursor: pointer;
        }

        /* Chat container styling */
        #chatContainer {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 90%;
            max-width: 400px;
            height: 500px;
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            z-index: 999;
            transform: translateY(100%);
            transition: transform 0.3s ease-in-out;
        }
        #chatContainer.show {
            transform: translateY(0);
        }

        /* Custom floating message box for the omit image warning */
        #floatingMessage {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            padding: 1rem 2rem;
            border-radius: 9999px; /* Pill shape */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            color: #444;
            font-weight: 500;
            z-index: 2000;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="flex flex-col items-center min-h-screen">
    <!-- Main loading screen shown on initial page load -->
    <div id="loadingScreen" class="flex items-center justify-center min-h-screen w-full">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-t-4 border-gray-900 mx-auto"></div>
            <p class="mt-4 text-gray-700">Cargando...</p>
        </div>
    </div>

    <!-- Main application container, hidden by default -->
    <div id="mainContainer" class="hidden w-full max-w-4xl p-4 sm:p-8">
        <!-- Header with logo and buttons -->
        <header class="flex flex-col md:flex-row justify-between items-center py-4 px-6 bg-white shadow-md rounded-b-xl mb-6">
            <h1 class="text-4xl font-extrabold text-blue-600 mb-2 md:mb-0">A3</h1>
            <div class="flex items-center space-x-4 mt-2 md:mt-0">
                <button id="createProfileBtn" class="py-2 px-6 rounded-full font-semibold text-white bg-blue-600 hover:bg-blue-700 transition duration-300 shadow-lg">
                    Crear Perfil
                </button>
                <button id="toggleChatBtn" class="py-2 px-6 rounded-full font-semibold text-white bg-green-500 hover:bg-green-600 transition duration-300 shadow-lg">
                    <i class="fas fa-comment-dots"></i> Chat
                </button>
            </div>
        </header>

        <!-- Container for displaying profiles -->
        <div id="profilesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Profiles will be dynamically rendered here -->
            <p class="text-center text-gray-500 col-span-full">Cargando perfiles...</p>
        </div>
    </div>

    <!-- Modal for profile creation and login -->
    <div id="profileModal" class="modal hidden">
        <div class="modal-content">
            <button id="closeProfileModalBtn" class="close-modal-btn">&times;</button>
            <h2 id="modalTitle" class="text-3xl font-bold text-center text-gray-800 mb-4">Crea tu Perfil</h2>
            <p class="text-center text-gray-600 mb-6">Por favor, completa la siguiente información.</p>
            <form id="profileForm" class="space-y-4">
                <div>
                    <label for="nickname" class="block text-sm font-medium text-gray-700">Apodo</label>
                    <input type="text" id="nickname" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="gender" class="block text-sm font-medium text-gray-700">Género</label>
                    <select id="gender" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Selecciona tu género</option>
                        <option value="Hombre">Hombre</option>
                        <option value="Mujer">Mujer</option>
                    </select>
                </div>
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700">Edad</label>
                    <input type="number" id="age" required min="18" max="99" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="district" class="block text-sm font-medium text-gray-700">Distrito de Lima</label>
                    <select id="district" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></select>
                </div>
                <div>
                    <label for="height" class="block text-sm font-medium text-gray-700">Estatura (cm)</label>
                    <input type="number" id="height" required min="120" max="220" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="whatsapp" class="block text-sm font-medium text-gray-700">Número de WhatsApp</label>
                    <input type="tel" id="whatsapp" placeholder="Ej: 987654321" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="profilePhotos" class="block text-sm font-medium text-gray-700">Fotos del Perfil (hasta 3)</label>
                    <input type="file" id="profilePhotos" accept="image/png, image/jpeg" multiple class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    <div id="imagePreviews" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
                <div id="modalMessageBox" class="hidden mt-4 p-3 rounded-lg text-sm text-center"></div>
                <button type="submit" id="submitProfileBtn" class="w-full py-3 px-4 rounded-md font-semibold text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300">
                    Guardar Perfil
                </button>
            </form>
        </div>
    </div>

    <!-- Floating message box -->
    <div id="floatingMessage" class="hidden text-center"></div>

    <!-- Chat container that slides up from the bottom right -->
    <div id="chatContainer" class="hidden">
        <div class="bg-blue-600 text-white p-4 rounded-t-xl flex justify-between items-center shadow-lg">
            <h3 class="text-lg font-semibold">Chat Público</h3>
            <button id="closeChatBtn" class="text-white hover:text-gray-200 text-xl"><i class="fas fa-times"></i></button>
        </div>
        <div id="chatBody" class="p-4 overflow-y-auto flex-grow bg-gray-50 space-y-3">
            <!-- Messages will be dynamically rendered here -->
        </div>
        <div class="p-4 border-t border-gray-200 flex items-center space-x-2">
            <input type="text" id="chatMessageInput" placeholder="Escribe un mensaje..." class="flex-grow p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="sendChatBtn" class="bg-blue-600 text-white p-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <script type="module">
        // Import necessary Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, onSnapshot, collection, query, where, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Set Firebase logging level to debug for detailed console output
        setLogLevel('debug');

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let auth;
        let db;
        let userId = null;
        let userProfile = null;
        let isChatOpen = false;

        // Get DOM elements for manipulation
        const loadingScreen = document.getElementById('loadingScreen');
        const mainContainer = document.getElementById('mainContainer');
        const profilesList = document.getElementById('profilesList');
        const createProfileBtn = document.getElementById('createProfileBtn');
        const toggleChatBtn = document.getElementById('toggleChatBtn');
        const chatContainer = document.getElementById('chatContainer');
        const closeChatBtn = document.getElementById('closeChatBtn');
        const chatBody = document.getElementById('chatBody');
        const chatMessageInput = document.getElementById('chatMessageInput');
        const sendChatBtn = document.getElementById('sendChatBtn');

        // Modal elements
        const profileModal = document.getElementById('profileModal');
        const closeProfileModalBtn = document.getElementById('closeProfileModalBtn');
        const profileForm = document.getElementById('profileForm');
        const nicknameInput = document.getElementById('nickname');
        const genderSelect = document.getElementById('gender');
        const ageInput = document.getElementById('age');
        const districtSelect = document.getElementById('district');
        const heightInput = document.getElementById('height');
        const whatsappInput = document.getElementById('whatsapp');
        const profilePhotosInput = document.getElementById('profilePhotos');
        const imagePreviewsContainer = document.getElementById('imagePreviews');
        const modalMessageBox = document.getElementById('modalMessageBox');
        const floatingMessageEl = document.getElementById('floatingMessage');


        // List of districts in Lima
        const limaDistricts = [
            "Ancón", "Ate", "Barranco", "Breña", "Carabayllo", "Chaclacayo", "Chorrillos", "Cieneguilla",
            "Comas", "El Agustino", "Independencia", "Jesús María", "La Molina", "La Victoria", "Lince",
            "Los Olivos", "Lurigancho-Chosica", "Lurín", "Magdalena del Mar", "Pueblo Libre", "Miraflores",
            "Pachacámac", "Pucusana", "Puente Piedra", "Punta Hermosa", "Punta Negra", "Rímac",
            "San Bartolo", "San Borja", "San Isidro", "San Juan de Lurigancho", "San Juan de Miraflores",
            "San Luis", "San Martín de Porres", "San Miguel", "Santa Anita", "Santa María del Mar",
            "Santa Rosa", "Santiago de Surco", "Surquillo", "Villa El Salvador", "Villa María del Triunfo"
        ].sort();

        // Function to populate the districts dropdown
        function populateDistricts() {
            districtSelect.innerHTML = `<option value="">Selecciona tu distrito</option>`;
            limaDistricts.forEach(district => {
                const option = document.createElement('option');
                option.value = district;
                option.textContent = district;
                districtSelect.appendChild(option);
            });
        }
        
        // Show a custom message in the modal
        function showModalMessage(message, isError = true) {
            modalMessageBox.textContent = message;
            modalMessageBox.classList.remove('hidden');
            if (isError) {
                modalMessageBox.classList.remove('bg-green-100', 'text-green-700');
                modalMessageBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                modalMessageBox.classList.remove('bg-red-100', 'text-red-700');
                modalMessageBox.classList.add('bg-green-100', 'text-green-700');
            }
        }

        // Show a custom floating message on the top of the screen
        function showFloatingMessage(message) {
            floatingMessageEl.textContent = message;
            floatingMessageEl.classList.remove('hidden', 'opacity-0');
            floatingMessageEl.classList.add('opacity-100');
            setTimeout(() => {
                floatingMessageEl.classList.remove('opacity-100');
                floatingMessageEl.classList.add('opacity-0');
                setTimeout(() => floatingMessageEl.classList.add('hidden'), 300);
            }, 5000);
        }

        // Initialize Firebase and set up authentication listener
        async function initializeFirebase() {
            try {
                if (!firebaseConfig) throw new Error("Firebase configuration is missing.");

                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        await fetchUserProfile(user.uid);
                    } else {
                        // Sign in anonymously if no user is found
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                    // Hide loading screen and show the main app
                    loadingScreen.classList.add('hidden');
                    mainContainer.classList.remove('hidden');
                });
            } catch (e) {
                console.error("Firebase initialization or authentication error:", e);
                loadingScreen.innerHTML = `<p class="text-red-500 font-bold">Error de inicialización: ${e.message}</p>`;
            }
        }

        // Fetch the user's own profile after authentication
        async function fetchUserProfile(uid) {
            const userProfileRef = doc(db, `/artifacts/${appId}/public/data/profiles`, uid);
            const docSnap = await getDoc(userProfileRef);
            if (docSnap.exists()) {
                userProfile = docSnap.data();
                createProfileBtn.textContent = 'Mi Perfil';
                toggleChatBtn.disabled = false;
                setupProfileListener();
                setupChatListener();
            } else {
                userProfile = null;
                createProfileBtn.textContent = 'Crear Perfil';
                toggleChatBtn.disabled = true;
                // If the user has no profile, show all "Mujer" profiles to all anonymous users
                setupProfileListener('Mujer');
            }
        }

        // Set up real-time listener for profiles based on user's gender
        function setupProfileListener(filterGender = null) {
            let profilesQuery;
            const profilesCollectionPath = `/artifacts/${appId}/public/data/profiles`;
            if (filterGender) {
                // For anonymous users, show only female profiles
                profilesQuery = query(collection(db, profilesCollectionPath), where("gender", "==", filterGender));
            } else if (userProfile) {
                // For logged-in users with a profile, show the opposite gender
                const oppositeGender = userProfile.gender === 'Hombre' ? 'Mujer' : 'Hombre';
                profilesQuery = query(collection(db, profilesCollectionPath), where("gender", "==", oppositeGender));
            } else {
                // Fallback, should not be reached but good practice
                profilesQuery = query(collection(db, profilesCollectionPath));
            }

            onSnapshot(profilesQuery, (snapshot) => {
                const profiles = [];
                snapshot.forEach(doc => {
                    // Do not show the user's own profile in the list
                    if (doc.id !== userId) {
                         profiles.push({ id: doc.id, ...doc.data() });
                    }
                });
                renderProfiles(profiles);
            }, (error) => {
                console.error("Error al obtener los perfiles:", error);
                profilesList.innerHTML = `<p class="text-center text-red-500 col-span-full">Error de permisos: ${error.message}</p>`;
            });
        }

        // Render the profiles to the UI
        function renderProfiles(profiles) {
            profilesList.innerHTML = '';
            if (profiles.length === 0) {
                profilesList.innerHTML = `<p class="text-center text-gray-500 col-span-full">No hay perfiles para mostrar.</p>`;
                return;
            }

            profiles.forEach(profile => {
                const profileCard = document.createElement('div');
                profileCard.className = 'bg-white p-6 rounded-2xl shadow-lg transition-transform hover:scale-105 duration-300 transform flex flex-col items-center text-center';
                
                // Determine which image(s) to show
                let profileImageHtml;
                if (profile.images && profile.images.length > 0) {
                    profileImageHtml = `
                        <div class="flex justify-center -space-x-4 mb-4">
                            ${profile.images.slice(0, 3).map(imgBase64 => `
                                <img class="w-24 h-24 rounded-full border-4 border-white object-cover" src="${imgBase64}" alt="Foto de perfil de ${profile.nickname}">
                            `).join('')}
                        </div>
                    `;
                } else {
                    profileImageHtml = `
                        <img class="w-24 h-24 rounded-full border-4 border-blue-200" src="https://placehold.co/100x100/e0e7ff/4338ca?text=${profile.nickname.charAt(0).toUpperCase()}" alt="Avatar de ${profile.nickname}">
                    `;
                }

                const whatsappUrl = profile.whatsapp ? `https://wa.me/${profile.whatsapp.replace(/\D/g, '')}` : '#';
                const whatsappButton = profile.whatsapp ? `
                    <a href="${whatsappUrl}" target="_blank" class="mt-4 px-6 py-2 bg-green-500 text-white font-semibold rounded-full shadow-md hover:bg-green-600 transition-colors">
                        <i class="fab fa-whatsapp mr-2"></i> Chatear
                    </a>
                ` : '';

                profileCard.innerHTML = `
                    ${profileImageHtml}
                    <h3 class="mt-4 text-xl font-bold text-gray-800">${profile.nickname}</h3>
                    <p class="text-gray-500 text-sm">${profile.gender}</p>
                    <ul class="mt-4 text-gray-700 text-sm space-y-1">
                        <li><span class="font-semibold">Edad:</span> ${profile.age} años</li>
                        <li><span class="font-semibold">Distrito:</span> ${profile.district}</li>
                        <li><span class="font-semibold">Estatura:</span> ${profile.height} cm</li>
                    </ul>
                    ${whatsappButton}
                `;
                profilesList.appendChild(profileCard);
            });
        }

        // Handle image previews before form submission
        profilePhotosInput.addEventListener('change', (event) => {
            const files = event.target.files;
            imagePreviewsContainer.innerHTML = ''; // Clear previous previews
            if (files.length > 3) {
                showModalMessage("Solo puedes subir un máximo de 3 fotos.");
                profilePhotosInput.value = ''; // Reset the input
                return;
            }

            for (const file of files) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'w-16 h-16 object-cover rounded-md shadow-md';
                    imagePreviewsContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });

        // Show/hide the profile creation modal
        createProfileBtn.addEventListener('click', () => {
            populateDistricts();
            profileModal.classList.remove('hidden');
            modalMessageBox.classList.add('hidden');
        });

        closeProfileModalBtn.addEventListener('click', () => {
            profileModal.classList.add('hidden');
        });

        // Handle profile form submission
        profileForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const files = profilePhotosInput.files;
            const images = [];

            // If no images are selected, show a floating message
            if (files.length === 0) {
                showFloatingMessage("¡Tu perfil es más atractivo con fotos! Considera agregar al menos una.");
            }

            // Read selected files and convert them to Base64 strings
            const readPromises = Array.from(files).map(file => {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
            });

            try {
                // Wait for all files to be read
                const base64Images = await Promise.all(readPromises);

                const profileData = {
                    nickname: nicknameInput.value.trim(),
                    gender: genderSelect.value,
                    age: parseInt(ageInput.value),
                    district: districtSelect.value,
                    height: parseInt(heightInput.value),
                    whatsapp: whatsappInput.value.trim(),
                    images: base64Images, // Store the Base64 image data
                    createdAt: serverTimestamp()
                };

                // Basic validation
                if (!profileData.nickname || !profileData.gender || !profileData.age || !profileData.district || !profileData.height) {
                    showModalMessage("Por favor, completa todos los campos requeridos.");
                    return;
                }
                if (profileData.age < 18) {
                    showModalMessage("Debes ser mayor de 18 años para crear un perfil.");
                    return;
                }

                const profileRef = doc(db, `/artifacts/${appId}/public/data/profiles`, userId);
                await setDoc(profileRef, profileData, { merge: true });
                showModalMessage("Perfil creado exitosamente.", false);
                profileModal.classList.add('hidden');
                // The onAuthStateChanged listener will automatically fetch the new profile and update the UI
            } catch (error) {
                console.error("Error al crear el perfil:", error);
                showModalMessage(`Error al guardar el perfil: ${error.message}`);
            }
        });

        // Chat functionality
        toggleChatBtn.addEventListener('click', () => {
            isChatOpen = !isChatOpen;
            if (isChatOpen) {
                chatContainer.classList.remove('hidden');
                setTimeout(() => chatContainer.classList.add('show'), 10);
                chatBody.scrollTop = chatBody.scrollHeight;
            } else {
                chatContainer.classList.remove('show');
                setTimeout(() => chatContainer.classList.add('hidden'), 300);
            }
        });

        closeChatBtn.addEventListener('click', () => {
            isChatOpen = false;
            chatContainer.classList.remove('show');
            setTimeout(() => chatContainer.classList.add('hidden'), 300);
        });

        sendChatBtn.addEventListener('click', sendMessage);
        chatMessageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const messageText = chatMessageInput.value.trim();
            if (messageText === '' || !userProfile) return;
            
            try {
                await addDoc(collection(db, `/artifacts/${appId}/public/data/chat`), {
                    userId: userId,
                    nickname: userProfile.nickname,
                    message: messageText,
                    timestamp: serverTimestamp()
                });
                chatMessageInput.value = '';
                chatBody.scrollTop = chatBody.scrollHeight;
            } catch (error) {
                console.error("Error al enviar el mensaje:", error);
            }
        }
        
        function setupChatListener() {
            onSnapshot(collection(db, `/artifacts/${appId}/public/data/chat`), (snapshot) => {
                chatBody.innerHTML = '';
                const messages = [];
                snapshot.forEach(doc => messages.push(doc.data()));
                messages.sort((a, b) => (a.timestamp ? a.timestamp.toMillis() : 0) - (b.timestamp ? b.timestamp.toMillis() : 0));
                
                messages.forEach(msg => {
                    const isSelf = msg.userId === userId;
                    const messageElement = document.createElement('div');
                    messageElement.className = `p-2 rounded-xl max-w-[80%] ${isSelf ? 'bg-blue-200 self-end rounded-br-none' : 'bg-gray-200 self-start rounded-bl-none'}`;
                    const senderName = isSelf ? 'Tú' : (msg.nickname || 'Anónimo');
                    messageElement.innerHTML = `<p class="font-bold text-sm">${senderName}</p><p>${msg.message}</p>`;
                    chatBody.appendChild(messageElement);
                });
                chatBody.scrollTop = chatBody.scrollHeight;
            }, (error) => {
                console.error("Error al obtener los mensajes del chat:", error);
            });
        }
        
        // Start the application after the window loads
        window.onload = initializeFirebase;
    </script>
</body>
</html>
